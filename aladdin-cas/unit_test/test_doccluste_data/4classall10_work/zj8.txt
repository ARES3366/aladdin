(最佳实践)(最佳实践)	AnyBackup5.0.2.0最佳实践MySQL定时备份目　录目　录	2第一章概览	41.1简介	41.1.1MySQL备份	51.1.2MySQL恢复	51.1.3任务管理	51.1.4重复数据删除	51.2MySQL定时备份支持功能	5第二章限制性列表	7第三章客户端安装	93.1安装部署	93.1.1开始之前	93.1.2安装	103.2客户端配置	16第四章MySQL备份环境检查	194.1客户端备份前置条件检查	194.2介质服务器检查及配置	19第五章定时备份恢复最佳实践	195.1命名规则说明	195.2MySQL定时备份最佳实践	205.2.1MySQLforWindows定时备份最佳实践	205.2.2MySQLforLinux定时备份最佳实践	285.3MySQL浏览恢复最佳实践	295.3.1恢复注意事项	295.3.2恢复粒度	305.3.3恢复步骤	30第六章FAQs	33第七章备份故障排除	357.1备份成功但有警告信息	357.2备份失败	35第八章恢复故障排除	368.1恢复成功但有警告信息	368.2恢复失败	36第一章概览1.1简介本文档是爱数备份容灾家族MySQL一体化备份恢复最佳实践文档，主要描述了如何正确地使用爱数备份容灾家族产品成员进行MySQL数据备份的方法，包括部署前后的注意事项和典型部署方案。MySQL是一个小型关系型数据库管理系统，开发者为瑞典MySQLAB公司。目前MySQL被广泛地应用在Internet上的中小型网站中。由于其体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，许多中小型网站为了降低网站总体拥有成本而选择了MySQL作为网站数据库。MySQL引擎介绍：MyISAM：MySQL的默认数据库引擎，最为常用。拥有较高的插入，查询速度，但不支持事务。InnoDB：事务型数据库的首选引擎，支持ACID事务，支持行级锁定。BDB：源自BerkeleyDB，事务型数据库的另一种选择，支持COMMIT和ROLLBACK等其他事务特性Memory：所有数据置于内存的存储引擎，拥有极高的插入，更新和查询效率。但是会占用和数据量成正比的内存空间。并且其内容会在Mysql重新启动时丢失。Merge：将一定数量的MyISAM表联合而成一个整体，在超大规模数据存储时很有用。Archive：非常适合存储大量的独立的、作为历史记录的数据。它们不经常被读取。Archive拥有高效的插入速度，但其对查询的支持相对较差。Federated：将不同的MySQL服务器联合起来，逻辑上组成一个完整的数据库。非常适合分布式应用Cluster/NDB：高冗余的存储引擎，用多台数据机器联合提供服务以提高整体性能和安全性。适合数据量大，安全和性能要求高的应用。CSV：逻辑上由逗号分割数据的存储引擎。BlackHole：黑洞引擎，写入的任何数据都会消失，一般用于记录binlog做复制的中继。1.1.1MySQL备份完全备份将选定的数据源完全备份到指定目的地的备份集中。每次执行时，它不会根据最新的变动比较后进行备份，而是直接将所有的数据备份到OFS介质中，并产生一个时间点，用于记录备份的内容。1.1.2MySQL恢复通过浏览恢复，恢复备份时间点。1.1.3任务管理1.【命名规则】:用户名、任务组、任务等对象命名规则满足：不允许为空，且名称长度必须为3~50个字符；2.【邮件命名规则】:Email地址只能由字母A~Za~z、数字0~9及特殊字符@.-_组成，类似于yourname@domain.com的形式，且最长不能超过50个字符；3.【备注信息规范】：备注信息最大不超过255字符；1.1.4重复数据删除本版本支持MySQL定时备份源端重复数据删除。1.2MySQL定时备份支持功能	功能	子功能	支持	备注	备份类型	完全备份	√	仅支持完全备份	客户端自动搜索实例		√		客户端多实例备份恢复		√	单个任务可以支持选择多个实例备份	浏览恢复		√		异机恢复		√		恢复粒度		√	整个实例、单个数据库	指定恢复数据库名		√	支持恢复数据库时恢复为新数据库名第二章限制性列表1、不支持跨系统平台的恢复（Windows、Linux不支持任意两个平台互相恢复）2、不支持跨MySQL版本的恢复3、要求备份和恢复端的实例名，用户名和密码一致，缺一不可第三章客户端安装3.1安装部署3.1.1开始之前1、客户端包括32-bit和64-bit两种类型，如果您使用的数据库为32-bit版本，则您应该使用32-bit的客户端；如果您使用64-bit的数据库，您应该使用64-bit的客户端。2、在linux平台安装客户端，选择以root用户安装。3.1.2安装Windows客户端安装方法点击【安装】如下点击【下一步】可以选择【更改】安装位置更改好安装位置后，继续【下一步】，如下图：指定好服务器IP和客户端IP地址后继续【下一步】如下图：选择是否安装iSCSIInitator工具和卷CDP驱动。当前系统非2000、2003或xp系统，iSCSI选项不可选,若是在2000,2003或者XP系统安装客户端，定时备份恢复MySQL数据库可以默认不勾选，定时备份不需要安装卷CDP驱动，确定后进行【下一步】，如下图：点击【安装】，开始安装，如下图：安装完成后，点击【完成】【关闭】退出向导。向导中的每一步都可以【取消】或者进行【上一步】回退操作。Linux下客户端安装方法1.登录到客户端所在的机器，将客户端安装包拷贝到指定位置2.解压安装文件，例如tarzxvfAnyBackupClient_Redhat_5_x64-5.0.1.0-20140725-release-2373.tar.gz3.进入解压后的目录，执行安装步骤，如下图所示3.2客户端配置在浏览器上输入http://IP:9800/的方式，然后输入用户名和密码登录控制台；点击数据保护，客户端名称中，可以查看新安装的客户端；将鼠标放在客户端上，可以查看客户端的详细信息，如下图；用鼠标选中对应的客户端，然后用户可以通过点击齿轮状的按钮，可以进行以下操作：新建客户端组：根据向导，建立客户端组后，用户可以采用鼠标拖动的方式，将对应的客户端加入对应的组中；修改名称：默认的名称为操作系统的hostname，为了能更方便识别，用户可以根据需要给客户端命名为一个容易识别的名称，以便管理；配置客户端：该选项用来重删任务数据设置，根据用户的实际资源情况，设置对应的数值即可，其中内存使用限制越大，性能越好；新建虚拟客户端：在此选项中，用户可以选择创建双机、集群、hyper-v和VMware客户端等第四章MySQL备份环境检查4.1客户端备份前置条件检查1、备份前，MySQL数据库的服务必须处于运行状态，否则展开实例失败。2、备份前，需确保数据库可正常连接使用。3、要求备份和恢复端的实例名，用户名，密码和端口号均一致，缺一不可。4、执行备份任务时，要求启动数据库服务，否则备份失败。4.2介质服务器检查及配置为保证备份任务可正常执行，在创建备份任务前，请检查介质服务器是否正常。检查方法，可以在登录控制台后，在存储管理，介质服务器管理中查看介质服务器状态及可用空间。第5章定时备份恢复最佳实践5.1命名规则说明1.【命名规则】:用户名、任务组、任务等对象命名规则满足：不允许为空，且名称长度必须为3~50个字符；2.【邮件命名规则】:Email地址只能由字母A~Za~z、数字0~9及特殊字符@.-_组成，类似于yourname@domain.com的形式，且最长不能超过50个字符；3.【备注信息规范】：备注信息最大不超过255字符；5.2MySQL定时备份最佳实践5.2.1MySQLforWindows定时备份最佳实践1、确认系统环境变量中包含了MySQL的bin目录在“我的电脑”上右键单击，选择属性，然后选择“高级”，单击“环境变量”，在Path变量中寻找是否包含有MySQL安装目录下的bin目录；在“开始”中运行“cmd”，然后输入：echo%path%确定，在输出信息中查找是否包含有MySQL安装目录下的bin目录。提示：MySQL安装完毕后系统路径可能不会包含bin目录，此时需手动添加。2、确认要备份的数据库可以正常连接使用在进入MySQL命令窗口后，可输入几条常用的命令来检查数据库是否可以正常使用。如：showdatabases；-----查看数据库列表useaaa；-----使用aaa数据库showtables;-----查看当前数据库下的所有表3、登录管理控制台，点击标签栏【数据保护】【备份管理】选项卡，在操作界面，选择【新建】，点击【定时备份】选择MySQL数据库，在弹出的新建任务向导中填写任务基本信息4、根据需要设置选项，数据库锁选项默认选中状态，点击【下一步】5、添加数据源，数据源支持自动发现实例，需要给实例授权之后才可继续展开实例。授权时，依次输入实例正确的用户名、密码和端口号，确定保存后即可成功展开实例。选择要备份的数据库后，继续点击【下一步】1.支持自动发现此备份服务器下所有的mysql实例，以实例名呈现2.必须要给实例添加正确的授权信息，实例才能进一步展开3.实例的用户名一般默认为root4.当后台数据库的密码包含有特殊字符，例如*，此时展开实例会失败。因为我们向后台传输数据是基于web的，这种情况下，会将发送的数据里面的html的特殊符号自动转变成具有语义的字符。所以实际传到后台的密码已经不是真正意义上的密码。当出现这种情况时，目前只能手动修改数据库密码后重新添加实例解决5.后台数据库的密码中包含有~、@、#、￥、%、（、）、！是可以支持展开实例的6.端口号默认为3306，可以支持手动修改添加前：点击设置，授权实例：展开实例：注意：1.支持备份单个数据库或整个实例。2.支持选择多个实例备份。3.不支持同一个数据库出现在多个任务中，创建任务会失败，提示如：选中的【mysql】在用户【admin】的任务【mmmm】中已存在。4.展开数据源时，能够浏览到系统数据库mysql，test和其他后期自定义的数据库，浏览不到系统数据库information_schema和performance_schema。information_schema确切说是信息数据库。其中保存着关于MySQL服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表栏的数据类型与访问权限等。在information_schema中，有数个只读表。它们实际上是视图，而不是基本表，因此，你将无法看到与之相关的任何文件。MySQL5.5新增一个存储引擎：命名performance_schema,主要用于收集数据库服务器性能参数。MySQL用户是不能创建存储引擎为PERFORMANCE_SCHEMA的表，故在数据源中将其屏蔽掉。6、计划的推荐配置在爱数产品中，有多种任务计划可以进行选择，比如每天、每周、每月、一次性。设置方法如下：进入任务设置计划向导，选择备份类型、备份计划、开始时间。支持继续添加、修改、删除或暂停计划注意：1.添加每月计划任务的时候，尽量避免选择31号、30号、29号进行定时备份，考虑到有的月份特殊，可选择28号及其之前的任何一个日期进行备份，这样可以保证每月都有任务执行。2.在设置【开始时间】时，建议您尽量在服务器空闲时进行备份操作；另外，在设置【最大保存完全副本数】时，可在综合考虑您的存储空间和数据需求等因素后进行合理的设置。（保留副本数策略：保留n个副本数，至少需要n+1个副本的空间）7、计划设置完毕，如果资源足够，请立即开始一次完全备份。选中任务，点击【发起】按钮，点击【备份】，选择需要的备份类型，即可开始备份操作5.2.2MySQLforLinux定时备份最佳实践1、确认要备份的数据库可以正常连接使用。在进入MySQL命令窗口后，可输入几条常用的命令来检查数据库是否可以正常使用。如：mysql-uroot-ppas----连接数据库showdatabases；-----查看数据库列表useaaa；-----使用aaa数据库showtables;-----查看当前数据库下的所有表2、任务的建立和执行步骤请参考window环境下的流程。特别提示：在linux环境下MySQL实例名以端口号来标识，如mysql3306，mysql3307等5.3MySQL浏览恢复最佳实践5.3.1恢复注意事项1、定时备份异机恢复时，务必保证异机的数据库实例名、用户名、密码和端口号均与源机保持一致，否则恢复失败。2、定时备份恢复时，务必启动MySQL数据库服务，否则恢复失败。3、不支持跨系统平台恢复（windows恢复到linux，linux恢复到windows）。4、不支持windows平台跨数据库版本恢复。5、不支持linux平台跨数据库版本恢复。5.3.2恢复粒度MySQL定时备份恢复，目前支持恢复整个实例级别，也支持恢复单个数据库。5.3.3恢复步骤备注：Windows和Linux只有恢复端的操作系统不一致，控制台的操作步骤一样。故具体的恢复流程均可参考下述恢复步骤。1.点击【任务管理】中的【发起】【浏览恢复】2.选择要恢复的时间点及数据注意：如果是要恢复到最新状态，推荐选择最新时间点。3.选择恢复位置，默认为恢复至原客户端原位置，恢复为原数据库名称注意：当同时选择多个数据库时，只可以恢复至原位置（或异位置）的原数据库名称，不支持恢复至指定目标数据库名称（此时“目标数据库名称”选项为灰色禁用状态）；当选择单个数据库时，可以恢复至原位置（或异位置）的原数据库名称，也可以恢复至指定数据库名称。支持选择多个实例恢复。4.选择恢复策略，默认为覆盖现有的数据库。可根据实际需求填写执行备注信息。5.确定完成后，即启动了恢复任务。可以在任务监控和任务历史记录中查看当前任务的执行状态和最终执行结果。第六章FAQs1、建立和执行备份任务时，要求启动数据库服务，否则不能添加数据源。2、必须要添加实例的授权信息，才能展开数据源。3、只支持完全备份。4、支持单个数据库、多个数据库、单个实例和多个实例的备份。5、恢复时必须保证数据库服务启动状态，否则恢复失败。6、支持最小粒度为数据库级别的恢复，也支持整个实例的恢复。7、支持选择多个实例恢复。8、要求备份和恢复端的实例名，用户名、密码和端口号一致，缺一不可。9、不支持跨MySQL版本的恢复。10、不支持跨平台恢复（Windows、Linux不支持任意两个平台互相恢复）。11、备份或恢复时，详细信息中的”执行信息、已完成数据量、当前速度”需要等待备份完成一个数据库或恢复完成一个数据库之后才会有信息显示。（所以如果有数据量较大的数据库正在备份或恢复，此三项信息显示为空白，属于正常现象）第七章备份故障排除7.1备份成功但有警告信息暂无。7.2备份失败·Q：redhat6-64bit下mysql5.6-64bit定时备份，当数据库密码为空时，任务备份失败。A：此现象属于正常情况。由于mysql5.6数据库的安全性提高了，本身并不支持密码为空时的备份。需要设置数据库的密码，删除原先的任务，重新创建任务备份即可（也可以编辑原先的任务，重新授权实例选择数据源，保存后再次备份）·Q：mysqlforlinux的环境，创建mysql定时备份任务，未添加实例授权，直接展开实例节点，提示连接实例失败（而非提示实例未授权）？A：此现象属于正常情况。虽然没有手动添加，但是此时实际上客户端安装目录bin目录下的mysqlserver.config文件已存在（linux平台下的特殊实现，为了通过实例名和socket文件来自动获取实例），且文件中只有实例名和port信息（port里面保存的是socket文件路径），user和password都是空的，待手动配置后才会更新写入。第八章恢复故障排除8.1恢复成功但有警告信息暂无8.2恢复失败·Q：恢复失败，报错：errorconnectingtodatabase，toomanyconnections？A：此现象是由于mysql的最大连接设置数小于实际选择要恢复的数据库个数。需要修改mysql配置文件中的max_connections数目大于等于要恢复的数据库个数并重启mysql服务。再次恢复即可成功。Q:当环境出现备份或恢复速度较慢，怎样解决?首先查看存储柜的cached值，如果cached值小于6GB时，可以使用以下方法进行性能调优。1.打开/etc/sysctl.conf文件。#vi/etc/sysctl.conf2.修改如下参数的值为下方参数对应的值，如参数名不存在则新增。vm.min_free_kbytes=0vm.swappiness=0vm.vfs_cache_pressure=0vm.dirty_background_ratio=50vm.dirty_ratio=80vm.dirty_writeback_centisecs=100003.保存/etc/sysctl.conf文件，并执行sysctl-p命令。(地址：上海市联航路1188号浦江智谷8号楼2层A座邮编：201112咨询热线：021-54222601服务热线：400-880-1569传真：021-54326441客服邮箱：support@eisoo.com)(WWW.EISOO.COM)(30/31)