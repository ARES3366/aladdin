(最佳实践)(最佳实践)	AnyBackup5.0.2.0最佳实践GBase定时备份目　录目　录	2第一章概览	41.1简介	41.1.1GBase备份	41.1.2GBase恢复	51.2GBase定时备份支持功能	5第二章限制性列表	7第三章客户端安装	83.1Windows客户端安装	83.1.1Windows环境确认：	83.1.2Windows客户端安装	123.2客户端配置	18第四章GBase备份环境检查	204.1Windows环境备份前置条件检查	204.1.1GBase环境检查	204.2介质服务器检查及配置	20第五章定时备份最佳实践	215.1GBase定时备份最佳实践	215.1.1命名规则说明	215.1.2定时备份任务建立	21第六章定时恢复最佳实践	316.1GBase恢复概述	316.2普通恢复	316.2.1普通恢复注意事项	316.2.2恢复步骤	316.2.3异机恢复操作步骤	34第一章概览1.1简介本文档是爱数备份容灾家族GBase一体化备份恢复最佳实践文档，主要描述了如何正确地使用爱数备份容灾家族产品成员进行GBase数据备份的方法，包括部署前后的注意事项和典型部署方案。GBase是南大通用数据技术有限公司汇聚多方科研力量推出的自主品牌的数据库产品，具有稳定、实用、高效等特性。GBase致力于打造高品质的国产数据库品牌，以完善的服务，推动中国数据库产业的发展。GBase8s安全数据库系统主要适用于涉密信息系统、信息系统安全等级保护要求中规定的三级以上信息系统、国民经济支柱行业核心信息系统，以及其他信息系统等对数据管理具有高安全需求的领域。GBase8g,也即南大通用数据库管理系统是具有完全自主知识产权的数据库产品，该产品符合SQL92、ODBC、JDBC、ADO.NET等国际数据库规范和开发接口，参照国际主流数据库产品定义，提供完备的数据存储和数据管理功能。1.1.1GBase备份完全备份将选定的数据源完全备份到指定目的地的备份集中。每次执行时，它不会根据最新的变动比较后进行备份，而是直接将所有的数据备份到OFS介质中，并产生一个时间点，用于记录备份的内容。增量备份是基于上一次备份（可以是完全也可以是增量），备份新增的数据到OFS介质中，同时产生相应的时间点。在尚未进行完全备份的情况下，进行增量备份时会自动转会为完全备份。差异备份是基于上一次完全备份，把数据源备份到OFS介质中，只备份文件内容有变动以及新增的文件，从而避免完全相同的文件重复的备份，同时产生一个时间点，以便恢复使用。在尚未进行完全备份的情况下，进行差异备份时会自动转会为完全备份。1.1.2GBase恢复1.GBase标准恢复通过浏览恢复，恢复备份时间点。1.2GBase定时备份支持功能	功能	子功能	支持	备注	备份类型	完全备份	√			增量备份	√			差异备份	√		循环备份		√	完全备份、增量备份和差异备份相结合的循环	客户端自动搜索实例		√		客户端多实例备份恢复		X	GBase只支持单实例的备份恢复	浏览恢复		√		异机恢复		√		恢复粒度		√	整个实例第二章限制性列表1、不支持64位系统恢复到32位系统，支持32位系统恢复到64位系统。2、不支持单个数据库或单个表的备份恢复。3、GBase不支持多实例备份。4、不支持跨GBase版本的恢复。5、GBase8S需要设置jar文件，即将安装目录下\GeneralData\GBase\BackupRestoreTool\lib\下的jdbc.jar复制一份在同目录下，改名为gbase-connector-java-8.2.02-bin.jar（注意要显示后缀名）。6、异机恢复时，恢复到所选时间点是指能恢复到当时备份的状态。7、不支持安装路径和数据文件存放路径不同的异机恢复。8、不支持指定位置恢复。9、不支持对同一数据库多个任务执行交叉备份。10、要求备份和恢复端的实例名，用户名和密码一致，缺一不可。11、建立和执行备份任务时，要求启动数据库服务，否则不能添加数据源。第三章客户端安装3.1Windows客户端安装3.1.1开始之前1、客户端包括32-bit和64-bit两种类型，如果您使用的数据库为32-bit版本，则您应该使用32-bit的客户端；GBase数据库不支持64bit环境的备份恢复。2、开始程序中的GBase的企业管理器中打开可以查看数据库的版本，如下图GBase版本为：GBase8g_8.3.0.5。3.1.2安装Windows客户端安装方法点击【安装】如下点击【下一步】可以选择【更改】安装位置更改好安装位置后，继续【下一步】，如下图：指定好服务器IP和客户端IP地址后继续【下一步】如下图：选择是否安装iSCSIInitator工具和卷CDP驱动。当前系统非2000、2003或xp系统，iSCSI选项不可选,若是在2000,2003或者XP系统安装客户端，定时备份恢复GBase数据库可以默认不勾选，定时备份不需要安装卷CDP驱动，确定后进行【下一步】，如下图：点击【安装】，开始安装，如下图：安装完成后，点击【完成】【关闭】退出向导。向导中的每一步都可以【取消】或者进行【上一步】回退操作。3.2客户端配置在浏览器上输入http://IP:9800/的方式，然后输入用户名和密码登录控制台；点击备份容灾，客户端名称中，可以查看新安装的客户端；将鼠标放在客户端上，可以查看客户端的详细信息。用鼠标选中对应的客户端，然后用户可以通过点击齿轮状的按钮，可以进行以下操作：新建客户端组：根据向导，建立客户端组后，用户可以采用鼠标拖动的方式，将对应的客户端加入对应的组中；修改名称：默认的名称为操作系统的hostname，为了能更方便识别，用户可以根据需要给客户端命名为一个容易识别的名称，以便管理；配置客户端：该选项用来重删任务数据设置，根据用户的实际资源情况，设置对应的数值即可，其中内存使用限制越大，性能越好；新建虚拟客户端：在此选项中，用户可以选择创建双机、集群、hyper-v和VMware客户端等第四章GBase备份环境检查4.1Windows环境备份前置条件检查4.1.1GBase环境检查1、GBase8s设置jdbc.jar（1）如果GBase的版本为GBase8s，则本需要将安装目录下\GeneralData\GBase\BackupRestoreTool\lib\下的jdbc.jar复制一份在同目录下，改名为gbase-connector-java-8.2.02-bin.jar（注意要显示后缀名）。2、可以连接数据。建立和执行备份任务时，要求启动数据库服务，否则不能添加数据源，无法连接数据库。3、如果备份数据量较大必须保证有足够的缓存路径空间（至少是实际数量的四倍以上）。4.2介质服务器检查及配置为保证备份任务可正常执行，在创建GBase备份任务前，请检查介质服务器是否正常。检查方法，可以在登录控制台后，在存储管理，介质服务器管理中查看介质服务器状态及可用空间；第五章定时备份最佳实践5.1GBase定时备份最佳实践5.1.1命名规则说明1.【命名规则】:用户名、任务组、任务等对象命名规则满足：不允许为空，且名称长度必须为3~50个字符；2.【邮件命名规则】:Email地址只能由字母A~Za~z、数字0~9及特殊字符@.-_组成，类似于yourname@domain.com的形式，且最长不能超过50个字符；3.【备注信息规范】：备注信息最大不超过255字符；5.1.2定时备份任务建立1.登录爱数备份控制台，点击【数据保护】【备份管理】，从左侧选择GBase对应的客户端，在【任务管理】中，点击新建按钮选择定时备份选择GBase数据库；2.输入任务名称，在备注处，输入自己想要的备份信息，选择想要的介质服务器作为备份的目的地，并选择对应的介质IP，信息填写完毕后，点击[下一步]按钮；3.在选项中，填设置想要的备份类型，是否开启高级功能选项，各个选项说明如下：【重复数据删除选项】勾选该选项可以启动源端重复数据删除的功能，该选项，在建立任务后，不能通过修改任务的方式更改此属性；【备份数据保存完全副本数】可以设置用户保留完全副本的个数；设置完成后，点击【下一步】按钮，继续；4.点击“+”号展开数据源，GBase定时备份任务支持自动发现数据源的功能，但是需要手动配置实例名，数据库的用户名和密码，具体如下图；需填写实例名、用户名、sysdba的密码，sysman的密码和密码卡密码。一般使用实例名为localhost，用户名为超级管理员sysdba用户，密码框中输入的是sysdba的密码，输入完成后可以点击测试按钮，查看配置是否OK，连接测试成功后，点击确定按钮；此时可以选中数据源，然后点击【下一步】继续注意：　　　　1.如果您的数据量非常大，选择临时路径时请保证有足够的空间,至少有要备份数据的4倍以上的空间。　　2.如果数据库实例信息需要修改，则在任务界面中删除数据库实例重新添加即可。　　3.建议设置的临时目录中最好非系统盘，不要包含其它数据，特别是系统数据。4.密码必须填写不可为空。FAQS：1.如果不授权实例直接选中数据源时，有如下报错，标明没有对实例进行授权，即：添加正确的实例名、临时路径、用户名和密码可解决。2.实例配置完成后，点击展开数据源，出现如下报错，该报错具体原因：1.实例名、用户名密码是否正确2.GBase服务是否启动3.gbase实例是否可以正常连接上4.客户端版本是否安装正确,目前只支持32位。5.设置计划，在此步骤，用户可以选择定时备份任务的执行策略，如执行什么类型的备份任务、一次性执行、每天执行、没几周执行、每月执行；开始时间为任务生效的时间，可以根据需要设置；针对GBase的计划任务来说，一般采用每周一次完全，每天一次增量的策略来保证数据安全，一般触发备份时间选择在用户应用较为空闲时执行，比如凌晨或周六周日；请注意，一定不要采用一次完全备份，剩下的全是增量的计划策略，以规避风险。针对用户的实际情况，及用户的IO需求、安全需求等，请仔细考虑任务计划策略的设置。在这里，推荐用户能够至少保证一个月的数据安全：1.每周末数据应用比较平缓的时候，进行一次完全备份；2.隔两日晚时进行一次增量备份；3.每日白天，隔一定时间做一次差异备份，比如每日晚上可以进行一次差异备份；4.设置保留完全备份副本数为4，这样能够保证近28天的数据不会被丢失；5.将日志存空间充足。GBase计划任务新建、修改、删除、暂停全部的功能如下：FAQS：1.对于数据库数据量较大的环境来说，比如100Ｇ数据，由于GBase自身备份恢复特点，在进行备份时会在临时目录中产生很多临时文件，从而占用大量空间。如果您是单表存储至少需要数据量的5倍的空间。建议您数据不要用单表存储的方式，这样会占用很多缓存路径的空间。2.在设置计划策略是，请务必不要使用一个完全后续全是增量备份的方式；一个月必须要进行至少一次的完全备份，以保护数据安全；6.在任务创建完毕后，如果觉得任务配置信息有误，可以在选中该任务，并点击“编辑”按钮，进行编辑；编辑的步骤，和创建任务的步骤基本相同；7.计划设置完毕，如果资源足够，请立即开始一次完全备份。选中任务，点击【发起】按钮，可以看到可以发起的操作类型，点击【备份】按钮，即可开始备份操作；FAQS：1.发起备份任务是，提示“请求失败，您没有进行该操作的权限”，该问题是由于控制台没有进行相关的授权，添加对应的授权后，即可解决；添加授权在控制台界面，【运营管理】【授权管理】中添加，输入对应的授权码，点击在线激活，即可；第六章定时恢复最佳实践6.1GBase恢复概述	AnyBackup5.01.0版本针对用户的实际需求提供时间点恢复方式；根据数据丢失范围，分析采用何种恢复措施：1）如果数据库已经毁坏，可以重装后恢复数据；2）如果想将整个数据库还原到一个以前的状态，在可以在恢复时指定恢复到时间点来进行恢复。6.2普通恢复6.2.1普通恢复注意事项1、定时备份异机恢复时，务必要避免此种情况：数据库sysdba或sysman密码不同。2、定时备份恢复时，务必启动GBase数据库服务。3、浏览恢复处只有选择时间点恢复。4、执行异机恢复时，原机异机的数据文件安和安装路径必须完全相同。5、受GBase软件版本的限制，本产品不支持GBase跨版本的恢复，也不支持64位数据库恢复32位或32位的恢复到64位。6、不支持恢复单个数据库。6.2.2恢复步骤1.点击【任务管理】中的【发起】-->【浏览恢复】，在恢复页面中选择要恢复数据源2.点击【恢复】按钮，选择要恢复的时间点及数据注意：这里只支持实例级别的恢复。3、选择恢复位置，默认为恢复至原客户端原位置注意：此处可以选择恢复至其他位置，如果是异机恢复，则异机上GBase数据库的安装路径和数据文件路径必须和原机相同点击下一步，填写执行备注信息，点击完成，任务即执行。6.2.3异机恢复操作步骤普通恢复可以做异机恢复，异机恢复具体步骤同原机，注意事项：注意：1、异机要和原机的安装路径、数据文件存放路径完全一致；目前支持恢复到其他客户端，但是恢复数据只能恢复到原路径。如果恢复目标机器GBase的安装路径或数据文件存放路径与原机不一致，会导致恢复失败。2、异机的sysdba、sysman密码必须和原机完全相同。如果sysdba不同则恢复可以成功，但恢复后密码为原机sysdba的密码；如果sysman密码不同，则恢复失败，提示：连接GBase数据库失败！3、目标机器数据库服务必须是开启状态，否则会连接不上数据库，无法找到数据文件目录，恢复失败。4、恢复的目标机器数据库必须正常，不可以删除GBase自带的系统数据库，否则会恢复失败。5、恢复时使用的是备份集中的密码，且是最后那一次备份时使用的密码。6、如果您的数据量很大，请确保临时路径空间足够大。7、异机恢复临时路径不可以选择只读、不可访问或含有空格的路径,不要填写过深的路径。8、正在执行恢复时不要占用临时文件。FAQS：根据实际测试过程中，遇到的问题，如实添加即可；Q:GBase8s恢复时出现不能连接到实例管理器，见图：A:没有修改jar文件，GBase8S需要设置jar文件，即将安装目录下\GeneralData\GBase\BackupRestoreTool\lib\下的jdbc.jar复制一份在同目录下，改名为gbase-connector-java-8.2.02-bin.jar（注意要显示后缀名）。Q:数据库恢复成功后GBase企业管理器还出现连接已中断，见图：A：1、数据库服务是否启动，GBase启动服务比较慢，可稍作等待，之后刷新自动成功。2、或者任务正在执行时停止任务，导致数据恢复不全，实例连接不上。Q:备份后修改数据库sysman密码或者重装修改了sysman密码，恢复之前的时间点失败，或者GBase8s恢复之前的时间点失败A：可能原因：1、备份是读取的客户端配置中记录的数据库实例信息，恢复读取的是任务备份集中的数据库实例信息，所以sysman密码不同不能连接实例管理器则恢复失败。2、GBase8s_没有修改jar文件导致不能连接实例管理器，如图解决方法：1、如果是原因1导致则改回sysman的密码为备份时的密码即可恢复成功。2、如果是原因2导致则将GBase8S设置jar文件，即将安装目录下\GeneralData\GBase\BackupRestoreTool\lib\下的jdbc.jar复制一份在同目录下，改名为gbase-connector-java-8.2.02-bin.jar（注意要显示后缀名）。注意：1、如果您恢复的是修改密码后的时间点，则恢复成功后密码不变与备份时的相同。2、建议您不要频繁的修改数据库sysdba和sysman密码。Q：数据库损坏，数据库无法恢复A：1、查看数据库错误日志，数据库为何损坏；当读取表空间数据不一致时，数据库会启不来，这时如果是GBase8s_8.3.81.51_32bit可以通过删除所有bin-log文件重启数据库服务即可。2、如果查看数据库错误日志通过上述方法无法解决可通过重装数据库，启动数据库实例后，执行恢复任务。3、异机恢复；找一个相同的良好的环境执行异机恢复，目标机器的数据库安装路径和数据文件存放路径需要和原机器相同，sysdba、sysman密码相同。Q：临时路径空间不足，备份或恢复失败。A:选择临时路径时一定要根据你的数据量和您可能增减的数据量来选择足够大的空间。Q:介质空间不够A：如果您备份的数据量比较大，请先确保介质空间足够。Q:出现GBase备份文件损坏，恢复失败A：重新执行备份恢复。Q:当环境出现备份或恢复速度较慢，怎样解决?A:首先查看存储柜的cached值，如果cached值小于6GB时，可以使用以下方法进行性能调优。1.打开/etc/sysctl.conf文件。#vi/etc/sysctl.conf2.修改如下参数的值为下方参数对应的值，如参数名不存在则新增。vm.min_free_kbytes=0vm.swappiness=0vm.vfs_cache_pressure=0vm.dirty_background_ratio=50vm.dirty_ratio=80vm.dirty_writeback_centisecs=100003.保存/etc/sysctl.conf文件，并执行sysctl-p命令。(WWW.EISOO.COM)(24/31)