微软中国信息级别：秘密级IGBase应用容灾最佳实践——爱数备份容灾家族3.5信息级别：秘密级I版权所有版权所有©2003-2012爱数软件有限公司。未经本公司书面许可，任何单位或个人不得以任何形式，复制、传播、摘抄本FAQ内容的部分或全部。本FAQ内容上可能会有增删和修改，爱数软件有限公司会定期将修订后的内容纳入新版本中，如有更改恕不另行通知。信息级别：秘密级II关于爱数作为全球智能数据管理解决方案提供商，爱数围绕客户的需求持续创新，与合作伙伴开放合作，在存储整合、备份容灾、文档管理、安全归档、云计算等多个领域构筑了围绕数据生命周期管理的创新型解决方案。在政府、教育、医疗卫生、企业等诸多领域，爱数为客户提供有竞争力的智能数据管理解决方案和服务，包括备份容灾一体化领域的旗帜——EISOOAnyBackupFamily；安全文档云——EISOOAnyShareFamily；以及面向数据中心和共享灾备中心的备份容灾云解决方案——EISOOTxFamily；同时还提供给用户和合作伙伴高附加值的EISOOAnySupport贴心服务。目前，爱数的产品和解决方案已经成功服务于全球上万用户，并持续改善客户体验，提升业务价值，共同迈向成功。爱数软件有限公司地址：上海市闵行区联航路1188号浦江智谷8号楼2层A座邮编：201112网址：www.eisoo.com客户服务电话：021-54222601客户服务邮箱：support@eisoo.comhttp://www.hanqintech.com/mailto:support@eisoo.com信息级别：秘密级III目录第1章.概述...................................................................................................................11.1.目标读者.........................................................................................................................11.2.本文档适用范围.............................................................................................................1GBase应用容灾功能模块简介..............................................................................................1第2章.GBase基础知识简介..........................................................................................12.1.GBase简介......................................................................................................................12.2.关键技术原理.................................................................................................................12.2.1.数据分离器(DataSplitter).................................................................................12.2.2.GBase复制原理分析..........................................................................................12.2.3.数据库一致性技术..............................................................................................2第3章.GBase应用容灾最佳实践...................................................................................43.1.GBaseforWindows应用容灾最佳实践.........................................................................43.1.1.部署注意事项（包括客户端安装、环境配置等前期准备工作）...................43.1.2.GBase应用容灾注意事项...................................................................................53.1.3.GBase应用容灾最佳操作...................................................................................73.1.4.GBase接管最佳操作.........................................................................................173.1.5.GBase数据恢复最佳操作.................................................................................213.1.6.GBase演习最佳操作.........................................................................................233.2.FAQ.................................................................................................................................25第1章.概述本文档是爱数备份容灾家族GBase应用容灾最佳实践文档，主要描述了如何正确地使用爱数备份容灾家族产品成员进行GBase数据容灾及应用容灾的方法，包括部署前后的注意事项和典型部署方案。1.1.目标读者本技术文档面向爱数备份容灾家族产品成员的用户和相关技术人员，主要介绍数据容灾和应用容灾的基础知识，以及如何正确使用爱数备份容灾家族产品成员部署GBase数据容灾及应用容灾。旨在通过此文档帮助用户和技术人员快速掌握GBase数据容灾和应用容灾模块使用方法。1.2.本文档适用范围项目范围产品爱数备份存储柜3.5.13GBase版本GBase8s_8.3.81.5132bit操作系统版本Windows2003ServerSP2(32bit)Windows2003Server(64bit)Windows2008Server(32bit)Windows2008Server(64tbit)Windows2008ServerR2(64bit)提示：本文档中的界面截图来自爱数备份存储柜3.5.13。GBase应用容灾功能模块简介功能描述功能模块容灾、时间点恢复、接管、演习客户端自动搜索实例不支持容灾粒度实例级别系统数据库容灾支持所有数据库的容灾客户端多实例容灾不支持同客户端多容灾任务不支持恢复方式时间点恢复恢复粒度服务器级别恢复位置原位置恢复为其他数据库名不支持信息级别：秘密级2异机恢复支持信息级别：秘密级1第2章.GBase基础知识简介2.1.GBase简介GBase是南大通用数据技术有限公司汇聚多方科研力量推出的自主品牌的数据库产品，具有稳定、实用、高效等特性。GBase致力于打造高品质的国产数据库品牌，以完善的服务，推动中国数据库产业的发展。GBase符合国际数据库规范，提供标准的开发接口，参照国际主流数据库产品定义，提供完备的数据存储和数据管理功能。该产品完全满足电子政务信息管理、电子商务交易管理和企业MIS等OLTP业务需要。GBase达到国外主要通用数据库产品80%左右的功能集合和90%的性能指标(TPC-C测试,GBase达到1477tpmcOracle为1512tpmc)。GBase的产品有：GBase8a,GBase8aCluster,Gbase8mALTIBASE,GbaseBI,GBase8d,GBase8s,GBaseETL,GBase8g。其中，GBase8s是硬加密安全数据库。GBase8s完全达到国标（GB/T20273—2006信息安全技术数据库管理系统安全技术要求）第三级的安全模型和安全要求（已通过公安部的等级评测）；提供包括数据存储加密、数据传输加密、自主访问控制、安全标签、强制访问控制、三权分立、安全审计、数据完整性等在内的主要安全功能和手段。2.2.关键技术原理2.2.1.数据分离器(DataSplitter)爱数的数据分离器是位于操作系统底层文件系统驱动上层的内核驱动程序，可以捕获操作系统上各应用的所有I/O请求，同时捕获变动数据，返回给客户端程序处理发送到介质端。注:捕获的I/O顺序完全按照操作系统原I/O顺序2.2.2.GBase复制原理分析GBase数据库主要包含数据文件.gbd、表定义文件.dsc、日志文件等；如果没有在信息级别：秘密级2GBase配置文件gs.ini中设定单表存储gsdb_file_per_table，那么数据都存放在gbdata1中，反之，设置了就存放在.gbd中,日志文件放在gb_logfile0和gb_logfile1中。备份时都会被备份。原文件修改后文件数据副本日志文件和数据库文件的任何字节变化块级变化都会被监控驱动捕获。插入数据记录Showdatabases;服务器上存在的数据库Createdatabaseeisoo;创建数据库eisooUseeisoo使用数据库eisooCreatetableeisoo(namevarchar(20),personIDvarchar(20));创建表eisoo，Showtables;显示eisoo数据库中的表Insertintoeisoovalues(‘laohe’,’0001’);向表eisoo中插入数据2.2.3.数据库一致性技术数据一致性概述数据一致性是指关联数据之间的逻辑关系是否正确和完整。可以简单理解为应用程序自己认为的数据状态与最终写入到磁盘中的数据状态是否一致。比如一个事务操作，实际发出了五个写操作，当系统把前面三个写操作的数据成功写入磁盘以后，系统突然故障，导致后面两个写操作没有写入磁盘中。此时应用程序和磁盘对数据状态的理解就不一致。当系统恢复以后，数据库程序重新从磁盘中读出数据时，就会发现数据在逻辑上存在问题，数据不可用，这就是数据一致性问题。Cache引起的数据一致性问题引起数据一致性的主要问题是位于数据I/O路径上的各种Cache或者Buffer(包括数据库Cache,文件系统Cache,控制器的Cache,磁盘Cache等)导致的，由于不同系统模块处理数据I/O的速度是存在差异的，所以就需要添加Cache来缓存I/O操作，适配不同模块的处理速度。这些Cache在提高系统处理性能的同时，也可能会“滞留”I/O操作，带来一些负面影响。如果在系统发生故障时，仍有部分I/O“滞留”在I/O操作中，真正写到磁盘中的数据就会少于应用程序实际写出的数据，造成数据的不一致。当系统恢复时，直接从硬盘中读出的数据可能存在逻辑错误，导致应用无法启动。对于一般的应用程序，自身修复能力较弱，如果出现数据不一致一般都需要重新配置，不过对于SQLServer,Oracle,DB2等大型数据库，其自身的修复能力是非常强的，它能信息级别：秘密级3根据redo日志重新生成数据，对日志中存在的不一致的情况也能自动处理，修复逻辑错误，抛弃损坏的块。数据一致性算法我们的应用容灾如何保证数据一致性呢，数据一致性的算法，通常分为启发式一致性（heuristicconsistency）和前摄式一致性（proactiveconsistency）两种:启发式一致性是指数据分离器通过文件系统能提高相关信息，判断应用程序的一致性状态，然后在CDP日志卷中标记相关信息，从而保证时间点恢复的数据一致性。前摄式一致性（proactiveconsistency），则是通过数据库程序的API让数据库处于一致性状态，然后在恢复日志中插入标记。前摄式一致性与启发式一致性最大的区别在于时间点粒度，启发式一致性保证不会修改数据库状态，所以可以达到更小的时间点粒度。爱数CDP数据库一致性技术正是采用启发式一致性，它的最小一致性粒度为数据库的一个事务级别,对GBase数据库我们支持恢复到任意时间点。信息级别：秘密级4第3章.GBase应用容灾最佳实践3.1.GBaseforWindows应用容灾最佳实践3.1.1.部署注意事项（包括客户端安装、环境配置等前期准备工作）1.身份验证Gbase8s可用两种身份验证方式，密码验证和密码卡验证，在这里GBase8s应用容灾只有密码验证。2.客户端版本a)爱数备份存储柜客户端的版本需与控制台的版本保持一致。b)爱数备份存储柜客户端包括32-bit和64-bit两种类型，GBase应用容灾只支持32-bit的客户端，所以您只能使用32-bit的客户端，GBase也只能使用32位GBase。如果您使用的客户端版本位数和备份的GBase版本位数不一致，可能会导致无法展开数据源。不支持Win2003(32bit)，但支持Windows2003SP2(32bit)；不支持Win2003(32bit)是因为GBase数据库不支持Windows2003(32bit)。3.客户端类型爱数备份存储柜客户端类型有三种：普通型、后台型、安全型，如下图。如果你在域用户登陆的服务器上安装安全型客户端，将会导致无法进行身份验证；因此，如果服务器的登陆用户是域用户，请安装普通型或后台型客户端（安全型客户端与指定用户绑定，只有该用户才能备份和恢复当前计算机的数据）。信息级别：秘密级54.生产机、容灾机数据库的安装容灾机的GBase安装版本必须和生产机的GBase安装版本一致,且容灾机的GBase的安装路径、数据文件路径必须和生产机的GBase安装路径、数据文件安装路径一致，因为初始化恢复会恢复到和生产机相同的路径，如果不同则恢复的数据无法在GBase服务器中显示；密码也应一致，否则初始化恢复会将生产机的密码文件也一起复制到容灾机，这样容灾机的数据库密码就会和生产机数据库密码一致；异机恢复到数据库密码不同的机器也会覆盖其数据库密码。执行任务前，请把要作为容灾机的数据转移，否则生产机的数据会覆盖容灾机的数据。5.生产机、容灾机绑定IP作为容灾的客户端，包括生产机和容灾机，在执行前都必须进行IP绑定，具体方法：Windows下在设置服务器地址中为客户端选择一个IP，注意，这个IP是一个可用的IP，不能是虚拟IP或被其他网络占用的IP；或者，修改安装目录..\AnyBackup\3.5Client下svraddr.config文件，在<propertyname="networkAdapter">下的<value></value>间输入IP，如下，然后重启客户端服务<propertyname="networkAdapter"><value></value></property>3.1.2.GBase应用容灾注意事项1.新建GBase应用容灾任务注意事项生产机和容灾机选择的网卡可用（至少有一个IP地址，且非自动获取的IP）。信息级别：秘密级6windows系统下当机器名为localhost时，重启容灾任务会提示添加虚拟IP失败。容灾的虚拟IP为做了外网映射，接管后虚拟IP要十几分钟才能在外网访问。2.虚拟IP检测注意事项新建容灾任务时，可能对冲突的IP检测的结果却是“不冲突”，这是由于：虚拟IP检测的方式是用ping发送数据包，对于不同网段或添加了防火墙等过滤数据包的主机，是ping不通的。建任务时添加的虚拟IP，如果冲突的话，将会导致接管失败。因此建议您确保添加的虚拟IP是不冲突的。本地连接属性必须不是占用状态。3.接管注意事项容灾任务必须在正常运行且增量恢复的状态下才能执行接管操作当生产服务器和容灾服务器的容灾任务为运行状态且尚处于初始化阶段时,不允许执行接管手工接管的对象是容灾服务器,若要接管到非容灾服务器上,则需要先添加此服务器为容灾任务的容灾服务器。可接管的容灾服务器的条件是：(1)容灾服务器“在线”(2)容灾服务器处于“恢复增量数据”状态(3)容灾任务的实时恢复状态为“运行”(4)是否可用状态为“可接管”接管前本地连接属性必须是非占用状态接管前生产机虚拟IP正常不因手动删除等原因丢失，在本地连接属性中有这个IP或者ipconfig/all可以查到这个IP4.演习注意事项容灾任务必须正常运行且增量恢复的状态下才能执行演习操作当生产服务器的实时备份任务为运行状态且尚处于初始化阶段时,不允许执行演习演习的对象必须是容灾服务器,若要在非容灾服务器上演习,则需要先添加为此容灾任务的容灾服务器可演习的容灾服务器的条件是：(1)容灾服务器“在线”(2)容灾服务器处于“恢复增量数据”状态(3)容灾任务的实时恢复状态为“运行”(4)是否可用状态为“可演习”4.容灾机注意事项执行任务前，请把要作为容灾机的数据转移，否则生产机的数据会覆盖容灾机的数据。5.恢复注意事项信息级别：秘密级7执行恢复前，请先将容灾任务停止。3.1.3.GBase应用容灾最佳操作1.配置客户端以管理员身份登录管理控制台，单击左边【系统管理】中的【客户端管理】，进入客户端管理界面。在右边的客户端列表中单击选择需要的客户端，然后单击【配置客户端】菜单，弹出【修改客户端配置】窗口如下所示：勾选GBase，然后单击【确定】按钮后退出。2.新建容灾任务步骤一：登录管理控制台，点击【容灾管理】下的【容灾任务管理】，单击右边的【新建任务】菜单，弹出的【新建容灾任务向导】窗口如下：信息级别：秘密级8输入任务名，在【请选择任务类型】下拉列表中选择GBase，设置生成时间点的间隔时间，数据类型选择普通数据，然后单击【下一步】按钮，进入【生产服务器】对话框。步骤二：【生产服务器】对话框如下图所示：选择一个生产服务器点击进入，在“GBase服务器”控件一层时选中“GBase服务器”，信息级别：秘密级9点击【添加GBase服务器】，在弹出的【添加GBase服务器】窗口中正确输入GBase数据库sysdba的密码，如下图，点击确定，退出【添加GBase服务器】窗口，可展开数据源，如下图。此处新增了【清理数据源】按钮，勾选数据库实例则在数据源列表中可以看到你要备份的数据源，点击【清理数据源】则会取消对数据源的勾选，点击【手工清理】则会清除掉数信息级别：秘密级10据源列表中数据。备份是备份的列表中记录的数据源。选择要容灾的数据库，可以选择单个数据库，也可以选择整个实例，选择完成后，点击【下一步】按钮，进入【选择目的地】对话框。添加GBase服务器后，展开数据源，只支持单个数据库实例进行容灾时，请确保容灾机含有与生产机数据源中的实例名相同的数据库实例，否则容灾任务会出错。容灾任务的生产服务器只能选择单个客户端上的数据，不能选择多个客户端的数据。步骤三：【选择目的地】对话框如下图所示：选择介质服务器，介质服务器上必须建立了OFS介质。【目的地日志卷】，日志卷作为异步复制的高速缓冲区，选择本地任何路径，如果产生数据量较大，请保证有较大的缓冲空间，如果空间不足会导致复制任务失败。信息级别：秘密级11配置完成后单击【确定】按钮。步骤四：选择生产机端虚拟IP绑定的网卡注意：虚拟IP会添加到此处选择的网卡上，此处可能会将某些虚拟网卡也信息级别：秘密级12列举出来，请确认所选择的网卡是可用的网卡，否则会出现添加虚拟IP后没有生效或者接管失败；可用的网卡：是有效的可访问的，此网卡非自动获取IP，非虚拟网卡。选择网卡后，单击【下一步】按钮，进入【容灾服务器】对话框。步骤五：【容灾服务器】对话框如下图所示单击【添加】按钮，会弹出【选择容灾服务器】的对话框，选择容灾服务器绑定网卡，如下图所示；信息级别：秘密级13此处选择的容灾服务器网卡，意义在于容灾接管后，将虚拟IP切换绑到到此网卡上，实现无缝的应用接管操作，此处选择的网卡也必须慎重，尽量确保虚拟IP能在容灾服务器端添加成功，当容灾机有多个网卡时，必须只选择一个可用的网卡（可用的网卡上一步骤的注意中有说明）。选择完成后，单击【确定】按钮，然后为容灾服务器配置日志池。信息级别：秘密级14单击【浏览】按钮，弹出【浏览目标计算机目录】窗口，选择日志卷路径，如下图所示选择一个可用的路径后，单击【确定】按钮。根据实际需要，在此可以添加指定的服务,添加的服务要确保此服务是非禁用状态，可以正常手工启动，（这里可以不添加任何服务），添加的服务在接管的时候会被启动，如下图所示信息级别：秘密级15选择成功后，单击【确定】按钮退出。单击【下一步】进入【容灾接管】对话框，填写故障检测设置和容灾接管设置。步骤六：故障检测和虚拟IP配置【故障检测设置】故障检测心跳周期默认为30秒，用户可根据需求自己设置。连续故障检测次数是指如果连续检测失败，则认为被检测的应用发生故障。心跳周期的设置不易太短，否则容易出现误判的情况。信息级别：秘密级16【启用重启策略】如果启用了重启策略，故障检测模块检测到故障后将自动重新重启生产机服务器GBase服务，并重新开始检测，如果超过了重启次数依然有故障，便开始接管（这里假定设置了自动接管）。【容灾接管设置】填写容灾接管设置虚拟IP和虚拟IP所在的子网掩码，添加的虚拟IP会在容灾任务开始执行时添加到生产服务器，这个IP必须是在生产服务器所在局域网内是可用并且不冲突的，否则会添加出错。“检测IP冲突”按钮可以用来检测欲添加的IP在生产服务器所在的网络内是否冲突，检测提示不冲突并不能保证无其他机器占用此IP（详情见3.1.2应用容灾注意事项），也无法保证此IP添加后一定有效，请确认后再添加。【自动接管】“自动接管”可勾选可不勾选，当勾选了自动接管则在生产服务器故障将触发容灾服务器自动接管应用，当勾选时会提示“网络不稳定时有可能触发误接管操作。请您确定是否要启用自动接管？”若点击“是“则在生产机网络异常时会自动接管(如果启用了重启策略，则重启失败后自动接管)，若点击”否“则不会自动接管，可在容灾任务管理中进行手动接管。【选项…】点击【选项…】，弹出任务管理对话框，在高级选项中有数据保留设置，如下图【选项...】设置容灾任务的循环删除策略，设置完成后，单击【完成】按钮，提交该操作到任务执行队列。【选项...】默认历史数据清理为不勾选状态，此处可勾选可不勾选，如果你的数据量过大更新速度过快，建议您选择勾选；如果你勾选了历史清理天数，则可填写历史保留时间和信息级别：秘密级17历史数据整理时间，默认保留时间是7天。若勾选则会在您所设置的时间点自动清理。建议填写的清理时间不宜过长。开始容灾任务前，需要手工停止容灾机对应的数据库服务，否则任务会出错。步骤七：成功创建容灾任务创建成功后进【容灾任务管理】界面，可查看创建成功的容灾任务属性，任务执行状态，主机状态，复制流向等，如下图所示。进【实时执行任务】界面，可查看任务的详细执行信息。3.1.4.GBase接管最佳操作这里指的是GBase手工接管的最佳操作。1.手工接管步骤一：生产服务器状态选中要接管的容灾任务，点击【手工接管】，弹出【手工接管向导】窗口，该窗口列出实时备份的状态，如下图所示信息级别：秘密级18这里只列出实时备份的一种状态，其他状态可根据实际情况区别对待。（比如：正在初始化复制时是不允许接管的，此时下方会提示：生产服务器正在复制原始数据，数据尚不完整，不允许接管。）点击【下一步】，进入【容灾服务器】选择列表。步骤二：选择要接管的容灾服务器该窗口列出所有容灾服务器的列表及状态，可任意选择其中某个满足接管条件的容灾服务器，选择完后，点击【下一步】进入【虚拟IP状态】视图。信息级别：秘密级19步骤三：【虚拟IP状态】如下图所示这里只列出虚拟IP的一种状态，其他状态可根据实际情况区别对待。（比如：此时当虚拟IP状态显示为正常则可用；若虚拟IP的状态会显示未添加，则不可用，此时接管会失败。）然后点击【下一步】，进入【接管】视图。信息级别：秘密级20步骤四：【接管】如下图所示这个界面的内容包含对前面几步的总结，选择接管理由，填写接管原因，然后点击【完成】按钮，将向生产服务器和容灾服务器发送接管指令，进入【实时执行任务】页面查看容灾任务执行输出信息，如下图所示信息级别：秘密级21输出如上信息后表明已经接管成功，并且新生产机开始初始化复制。注意：因为接管时需要完成所有数据的恢复，所以如果点击接管时尚有数据未恢复完，可能需要等待一段时间，等恢复完成才会开始执行接管操作。3.1.5.GBase数据恢复最佳操作原生产服务器的故障恢复后，需要把新生产服务器（原容灾服务器）上的数据恢复到原生产服务器。可以通过下面的任何一种方式恢复数据。第一种方式：通过OFS数据恢复数据登录管理控制台，依次点击【备份恢复管理】→【恢复管理】→【浏览恢复】。信息级别：秘密级22展开介质服务器根节点，在任务列表框中单击展开您需要恢复的GBase容灾任务，单击右边的【时间点】下拉框，选择您需要恢复到的时间点，勾选全选，选择要恢复的数据源，然后点击【恢复到客户端】按钮，将弹出【客户端恢复】对话框，选择您要恢复到的客户端。点击【恢复】后会跳出容灾数据恢复风险警告，如下图所示。信息级别：秘密级23注意：1.目前支持恢复到其他客户端，但是恢复数据只能恢复到原路径。如果恢复目标机器GBase的安装路径或数据文件存放路径与生产机不一致，会在完成所有数据恢复后,无法在GBase服务器中显示，此时需要手工附加数据库。2.如果目标机器存在相同的数据库，需要先将目标机器上的需要恢复的数据库对应的服务关闭，否则数据文件处于GBase独占状态，会提示容灾机数据库服务开启，写入数据块失败的错误!单击【确认执行】按钮，提交该恢复操作到任务执行队列。数据恢复完成，开始进入增量恢复，如下图所示。第二种方式：通过反向复制的方式恢复数据修改原来的容灾任务，添加原生产服务器为容灾服务器（原生产服务器不在容灾或实时任务中，且数据库服务关闭）。进入增量备份恢复后，进行手工接管。接管完成后，可以通过修改任务，添加原来的容灾服务器作为新容灾服务器继续进行应用容灾。注意：1.如果采用第一种方式恢复数据，在恢复数据期间，新生产服务器的数据变化将不会恢复到原生产服务器上，因此应该选择空闲时间进行恢复。2.因为只支持数据库实例的容灾，所以您选则的数据源只能是整个数据库实例。此时生产机上的数据都会复制到容灾机上，生产机和容灾机有同名数据库则会覆盖容灾机的数据库，容灾机本有而生产机没有的数据会被覆盖;。3.1.6.GBase演习最佳操作步骤一：选择用于演习的容灾服务器选中要演习的容灾任务，点击【开始演习】，弹出【选择用于演习的容灾服务器】窗口，会列举出所有容灾服务器的列表及状态，可任意选择其中满足演习条件的容灾服务器进行模拟演习。信息级别：秘密级24在【选择用于演习的容灾服务器】窗口中选择要准备演习的容灾服务器，点击【确定】按钮，进入【实时执行任务】页中对应的容灾任务，查看演习任务具体执行信息。输出“已成功启动演习，将停止恢复，进入演习模式”后，表明演习成功。步骤二：取消演习首先，手工停止容灾机对应的数据库服务。然后，在【容灾任务管理】页面，点击【取消演习】即可，容灾机会重新初始化恢复。如下图所示。信息级别：秘密级25此时，演习成功结束。3.2.FAQ问题1：新建GBase应用容灾任务时，展开数据源时，获得数据库列表失败的四种情况问题描述：新建GBase容灾任务，添加GBase服务器时获得数据库列表失败情形1：提示:获得数据库列表失败，请检查用户名密码是否正确，数据库是否启动信息级别：秘密级26问题原因：出现此现象是由于生产机的数据库服务未启动或者启动了但是数据库连接不上。解决方法：1.确认正确安装GBase数据库，系统支持GBase数据库，有GBase服务与GBase进程2.启动生产机数据库服务器3.连接GBase企业管理器可连接上,见下图4.输入正确的密码若未能连接上，则查看GBase错误日志gbase-error.log可查看具体原因。问题原因：出现此现象是由于输入的GBase数据库用户名或密码错误解决方法：1.启动生产机数据库服务器2.连接GBase企业管理器可连接上3.输入正确的密码情形3：提示：获得数据库列表失败，原因是:[Microsoft][ODBC驱动程序管理器]未发现数据源名称并且未指定默认驱动程序信息级别：秘密级27问题原因：出现此现象是由于客户端没有GBase数据库或者未正确安装或者GBase服务没启动，没能检测到客户端的GBase数据库服务。解决方法：1.确认正确安装GBase数据库，系统支持GBase数据库，有GBase服务与进程2.启动生产机数据库服务器3.连接GBase企业管理器可连接上4.输入正确的密码注意：如果客户端GBase数据量较大（比如300G），若重启生产机数据库服务，则企业管理器连接时需要比较长的时间，根据客户端速度进程占用内存使用情况的不同，可能要一两个小时。从GBase的错误日志gbase-error.log中可查看具体原因。数据库服务启动，密码正确，但连接不上，因为数据库实例没连上，呈offline或crashed或notstarted状态。每次重启都要从数据库的.gbd文件中读取所有的表空间信息，而读取又非常慢，所以很久启不来，这是GBase自身特点。信息级别：秘密级28情形4：提示：您还没有添加任何GBase服务。问题原因：此客户端没有添加GBase数据库实例。解决方法：正确添加GBase数据库实例问题2：GBase数据库实例未停止错误描述：演习结束未停止容灾机的GBaseManager服务，在实时执行任务中会报下面的警告错误原因：取消演习前没有停止容灾机的GBaseManager数据库服务解决方法：关闭容灾机的GBaseManager服务，将任务重新停止、开始一次信息级别：秘密级29注意：正在执行容灾的任务不可以再次执行容灾或实时任务，添加数据库实例的地方也会失败。问题3：接管时出现生产服务器添加虚拟IP失败错误描述：接管时出现生产服务器添加虚拟IP失败虚拟IP会在这里看到信息级别：秘密级30错误原因：生产机设置本地连接的地方被占用，比如本地连接属性的地方没有关闭，或者添加虚拟IP时选择了一个自动获取IP的网卡。解决方法：接管前确保生产机和容灾机的本地连接属性非占用状态，且生产机和容灾机运行正常，生产机虚拟IP正常添加在一个非自动获取IP地址的网卡上。问题4：手工接管时，虚拟IP状态未添加错误描述：接管时出现生产服务器虚拟IP状态为：未添加，如下图信息级别：秘密级31错误原因：此时生产服务器的虚拟IP状态不正常，或者执行接管时并没有真正的选中此任务解决方法：1.确认生产机确认其虚拟IP是正确添加的2.刷新页面重新达到接管条件后重新执行接管任务3.执行接管任务前要确保所要接管的任务是选中状态注意：新建任务时IP配置开启，则添加虚拟IP失败；接管时IP配置开启，则生产机删除虚拟IP失败；接管时容灾机IP配置开启，则新生产服务器添加虚拟IP失败，新生产服务器添加虚拟IP失败，请您确认原生产服务器虚拟IP已删除或者此IP未被其它的机器使用，并手动将此虚拟IP添加到新的生产服务器上。请您在解决问题后手动启动任务。问题5：新建任务时执行失败，容灾服务器数据库实例GBaseManager未停止错误描述：新建任务时执行失败，容灾服务器数据库实例GBaseManager未停止信息级别：秘密级32信息级别：秘密级33错误原因：容灾机的GBase数据库服务GBaseManager未停止解决方法：停止容灾机GBase数据库的GBaseManager服务，重新开始任务即可问题6：中文数据库输出信息中含有乱码错误描述：GBase数据库中有中文数据库，在任务执行中，输出信息含有乱码错误原因：这是GBase数据库本身中文字符转换机制，在GBase数据库中存储的数据就是以unicode码形式转化存储的;当数据库名中含有中文时，其对应的文件名有规律如下：1.如果字符为汉字，则对应的文件名为:@该汉字所对应的unicode码2.如果字符为@，则对应的文件名为:@0040举例：名为"爱数@eisoo"的数据库所对应的文件夹名为"@7231@6570@0040eisoo"，如下图所示信息级别：秘密级34解决方法：出现中文时，如上所述所以会有界面显示问题，不必介意问题7：接管时生产机删除虚拟IP失败或者容灾机添加虚拟IP失败错误描述：接管时，生产服务器错误原因：接管之前虚拟IP就已经丢失了解决方法：接管前确保生产机虚拟IP正常显示注意：删除虚拟IP失败，如果你是断网造成的自动接管，已经接管成功很久了，原生产机还没有恢复网络，那肯定删除不了，因为和生产机都没有通信了；或者强关生产机，自动接管成功后很久，生产机还未启动，也是删除不了生产机的虚拟IP的，而且这两种情况生产机后面启动了，它的虚拟IP还在，则会起冲突。问题8：多次重启介质服务导致出错，可能OFS已损坏错误描述：初始化复制或者恢复时重启介质服务导致任务出错，可能OFS已损坏，找不到CID,启动数据库发生未知异常，任务异常结束错误原因：1.任务执行过程中，数据库无法启动2.当一个任务正在执行中多次执行重启控制台服务、介质服务、数据库服务解决方法：查看有没有数据文件，分析ofs日志信息。建议：在任务执行过程中不要多次重启控制台、介质服务、数据库服务。问题9：任务正在正常执行时重启柜子，任务状态信息出错，出现生产机状态为：在线复制原始数据，容灾机状态为：在线，恢复增量数据信息级别：秘密级35错误描述：任务状态信息出错，出现生产机状态为：在线复制原始数据，容灾机状态为：在线，恢复增量数据解决方法：当任务正在增量复制阶段发生柜子重启时，随着容灾初始化复制和恢复完成，容灾任务可以自己恢复到正常状态。或者可以重现开始任务，重新执行。(这是容灾模块共有的现象)问题10：数据量过大时接管时，提示容灾机数据库实例连不上错误描述：容灾机数据量过大重启数据库服务连接不上实例管理器。但备份恢复需要基于数据库实例去获取备份信息。信息级别：秘密级36如果开启了自动接管，则会触发自动接管，但不符合自动接管条件。见下图解决方法：当数据量比较大时可以建议不设置重启策略，重新启动数据库服务，当可以连接上数据库实例后再重新开始任务。信息级别：秘密级1上海爱数软件有限公司Add：上海市闵行区联航路1188号浦江智谷8号楼2层A座Tel：+86-021-54222601Fax：+86-021-54326440	第1章.概述	1.1.目标读者	1.2.本文档适用范围	GBase应用容灾功能模块简介	第2章.GBase基础知识简介	2.1.GBase简介	2.2.关键技术原理	2.2.1.数据分离器(DataSplitter)	2.2.2.GBase复制原理分析	2.2.3.数据库一致性技术	第3章.GBase应用容灾最佳实践	3.1.GBaseforWindows应用容灾最佳实践	3.1.1.部署注意事项（包括客户端安装、环境配置等前期准备工作）	3.1.2.GBase应用容灾注意事项	3.1.3.GBase应用容灾最佳操作	3.1.4.GBase接管最佳操作	3.1.5.GBase数据恢复最佳操作	3.1.6.GBase演习最佳操作	3.2.FAQ