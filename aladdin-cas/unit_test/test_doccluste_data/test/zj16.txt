(最佳实践)(最佳实践)	AnyBackup5.0.2.0最佳实践文件系统定时备份恢复目　录目　录	2第一章概览	41.1简介	41.1.1文件系统备份	41.1.2文件系统恢复	51.2文件系统定时备份支持功能	5第二章限制性列表	7第三章客户端安装	93.1Windows客户端安装	93.1.1Windows环境确认：	93.1.2Windows客户端安装	103.2Linux客户端安装	143.2.1Linux环境确认：	143.2.2Linux客户端安装	153.3客户端配置	18第四章文件系统备份环境检查	194.1Windows环境备份前置条件检查	194.1.1备份本地存储-客户端服务检查	194.1.2备份网络映射卷-客户端配置检查	204.2Linux备份前置条件检查	244.2.1客户端服务检查	244.3介质服务器检查及配置	25第五章定时备份最佳实践	265.1文件系统定时备份最佳实践	265.1.1命名规则说明	265.2定时备份任务建立	26第六章定时恢复最佳实践	426.1文件系统恢复概述	426.2普通恢复	436.2.1普通恢复注意事项	436.2.2恢复步骤	436.2.3异机恢复操作步骤	47第一章概览1.1简介本文档是爱数备份容灾家族文件系统一体化备份恢复最佳实践文档，主要描述了如何正确地使用爱数备份容灾家族产品成员进行文件数据备份的方法，包括部署前后的注意事项和典型部署方案。1.1.1文件系统备份1.1.2文件系统恢复1.1.3任务管理1.1.4重复数据删除1.1.1文件系统备份完全备份将选定的文件数据源完全备份到指定目的地的备份集中。每次执行时，它不会根据最新的变动比较后进行备份，而是直接将所有的文件数据备份到OFS介质中，并产生一个时间点，用于记录备份的内容。增量备份是基于上一次备份（可以是完全也可以是增量），备份新增的数据到OFS介质中，同时产生相应的时间点。在尚未进行完全备份的情况下，进行增量备份时会自动转会为完全备份。1.1.2文件系统恢复标准恢复在文件数据被损坏或者丢失时，使用之前的文件系统备份集来实现文件数据的还原。1.2文件系统定时备份支持功能	功能	子功能	支持	备注	备份类型	完全备份	√			增量备份	√		循环备份		√	完全备份、增量备份相结合的循环	客户端多任务备份恢复		√		浏览恢复		√		异机恢复		√		恢复粒度		√	单个文件，文件夹，整个磁盘	指定恢复路径		√	本机原位置，本机异位置或以及异机不同版本操作系统的客户端	灾难恢复			第二章限制性列表1.本版本不支持稀疏文件的备份恢复。2.本版本支持加锁文件的定时备份恢复（保证备份前与备份后的文件一致，但文件恢复后依旧加锁，不能打开）。3.本版本不支持系统乱码文件的定时备份恢复。4.本版本不支持文件备份数据跨平台恢复（比如从Linux系统备份的数据恢复到Windows系统，或者从Windows系统备份的数据恢复到Linux系统下等）。5.本版本不支持软链接文件恢复至异位置，恢复后软链接找不到链接的目标文件。6.本版本不支持Linux系统环境下文件或者目录的路径总长度超过255字节的备份恢复。7.单文件夹下文件数量超过100万文件后，此基础上随着数据量（文件个数）越多，备份速度越慢。8.本版本不支持32位系统下千万级小文件（1K及1K以下小文件）的备份恢复。9.异机恢复，目的端必须跟源端系统一致，否则文件恢复后安全属性可能丢失。10.备份Windows环境的文件数据，本版本不支持在控制台界面编辑任务，添加文件进行增量备份，若是从界面修改数据源，进行增量备份时会自动转化成完全备份。11.不支持备份数据恢复到只读目录下。12.本版本不支持Windows系统环境下文件或者目录的路径总长度超过226字节的备份恢复。13.Windows环境下不支持DVD、CD、软驱内文件数据的的备份恢复。14.不支持展开单个目录下百万级文件，展开时间较长，可直接选择此目录进行备份恢复。15.对系统文件或正在运行的程序文件不能进行原位置恢复，否则会影响系统或程序的稳定性。16.本版本不支持Windows环境下的文件级增量备份，仅支持归档位增量备份。归档位增量备份不会备份文件及目录的属性变化,也不会备份数据源中新建的空文件夹（除非该文件夹中有新建的文件）原因：归档位本身存在此缺陷。17.文件完全备份后，会将文件的归档位属性去除，若是仅改变文件的其他属性（除归档位），再次增量备份该文件，由于文件的归档位没有勾选上，增量备份不会备份上文件改变的属性。18.支持Linux环境下由多种字符组成的目录或者文件名称的备份恢复（如：文件或者目录名称，包含：中文字符+英文字符+空格+标点符号等，备份恢复时会提示警告，警告文件或者目录名称不合法）。19.如果在任务编辑中设置了过滤与包含条件，且过滤条件与包含条件本身发生冲突，那么以过滤条件为优先。20.不能保证备份过程中文件的一致性。第三章客户端安装3.1Windows客户端安装确定客户端安装包，需要确定用户环境中操作系统的位数，32位系统环境上只能安装32位的客户端安装包，64位系统环境中可以安装64位和32位的客户端安装包3.1.1Windows环境确认：cmd中，运行systeminfo命令，查看系统版本信息，如下：3.1.2Windows客户端安装将客户端安装包拷贝到相应的盘符下，然后按照安装向导进行安装，安装步骤如下：第一步：点击客户端的.exe安装包，出现安装安装协议，勾选同意协议，点击【安装】第二步：安装完成后，会出现安装向导，点击【下一步】进行安装配置第三步：选择需要安装的路径，默认路径在C盘下，设置完成安装路径之后，点击【下一步】第四步：配置服务器IP，输入正确的服务器IP，然后点击【下一步】第五步：选择是否安装文件iSCSIInitator工具，当前系统非2000、2003或xp系统，iSCSI选项不可选(事例图片为2008环境)，若是在2000,2003或者XP系统安装客户端，备份恢复文件数据可以默认不勾选第六步：点击下一步，配置完成，点击【安装】，客户端将自动安装完成，可以到开始界面查看安装的信息若是需要将客户端连接到其他的服务器，可以配置客户端，修改服务器地址（IP），点击测试，可以看到连接成功的提示。3.2Linux客户端安装3.2.1Linux环境确认：在root用户下用命令uname–a，查看操作系统位数，i686,i386字样的为32bit操作系统，输出有x86_64的为64bit操作系统：[root@localhost~]#uname-aLinuxlocalhost.localdomain2.6.18-92.el5#1SMPTueApr2913:16:12EDT2008i686i686i386GNU/Linux在root用户下用命令cat/etc/issue，查看操作系统发行版本，我们的客户端支持redhat4、5、6，其中redhat5和redhat6使用相同的安装包，redhat4提供单独的客户端安装包，这点需要注意，同时对于其它linux发行版本，可以根据系统内核版本确认使用的客户端安装包，内核版本为2.6.9-xx的系统应使用redhat4的安装包，2.6.18-x及以上应使用普通的linux安装包，对于2.4.x及以前的版本将不再支持；[root@localhost~]#cat/etc/issueRedHatEnterpriseLinuxServerrelease5.2(Tikanga)Kernel\ronan\m3.2.2Linux客户端安装root用户下，在根目录下，创建eisoo文件夹；将确定好的客户端安装包上传到eisoo目录下，如果安装包在网络上，那么使用curl–O的方式获取：[root@localhosteisoo]#curl–O+安装包包的绝对路径然后用tar–zxvfpackage_name的方式解压：[root@localhosteisoo]#tar-zxvf	AnyBackupClient_Redhat_5_x86-5.0.0-20140304-release-1496.tar.gz切换到客户端安装文件夹的bin目录下，运行脚本./install.sh；	[root@localhostbin]#cd	/eisoo/AnyBackupClient_Redhat_5_x86-LASTEST/app/bin[root@localhostbin]#./install.sh在客户端安装过程中，安装程序会检测安装条件是否满足，在条件不满足时，需要	手动调整或者选择让程序自行调整，调整完成后，安装任务继续；第一步，填写自己的IP地址，针对一个服务器有多个网卡的情况，通过输入此IP，	可以使备份数据通过指定的网卡备份，同时在控制台中显示时，显示该IP地址；第二步，填写控制台的IP地址；第三步，选择支持的数据库，在做文件系统备份时，不需要作特殊的选择，仅选择	1noneed（root）即可第四步，选择是否安装CDP驱动，如果用户需要做实时备份或者应用容灾，需要安	装此驱动，做定时备份不需要安装，此处我们选择no；第五步，确认选择无误后，输入y，确认安装；如果之前选择有误，可以输入no退	出安装，然后重新运行安装脚本；FAQS:1.务必将客户端安装在新建的eisoo目录下，因为客户端安装会修改客户端所在目录的权限，如果安装在系统目录下，系统目录的权限可能会被修改造成系统问题或者用户应用出现问题；2.客户端安装成功之后，客户端服务自动启动，可以到控制台查看客户端的连接情况。3.3客户端配置在浏览器上输入http://IP:9800/的方式，然后用用户名和密码登录控制台；点击备份容灾，客户端名称中，可以查看新安装的客户端；将鼠标放在客户端上，可以查看客户端的详细信息，若下图；用鼠标选中对应的客户端，然后用户可以通过点击齿轮状的按钮，可以进行以下操作：新建客户端组：根据向导，建立用户端组后，用户可以采用鼠标拖动的方式，将对应的客户端加入对应的组中；修改名称：默认的名称为操作系统的hostname，而hostname不好识别，用户可以根据需要给客户端命名为一个容易识别的名称，以便管理；配置客户端：该选项，可以配置重删数据任务设置和卷实时任务设置，根据用户的实际资源情况，设置对应的数值即可，其中内存使用限制越大，性能越好；新建虚拟客户端：在此选项中，用户可以选择创建双机、集群、hyper-v和VMware客户端；第四章文件系统备份环境检查4.1Windows环境备份前置条件检查4.1.1备份本地存储-客户端服务检查安装完成客户端之后，可以查看客户端的服务（5RClient）是否正常启动，若是正常启动，查看是否连接上控制台，连接上之后，无需特别配置，就可以创建文件系统的定时备份任务4.1.2备份网络映射卷-客户端配置检查如果要进行网络映射盘的备份，需要对客户端做一些设置，设置方法为：客户端添加映射网络驱动，右击【我的电脑】-【映射网络驱动】，浏览共享的网络文件并指派一个驱动器号，点击【完成】即可，如图所示：这样就可以从【我的电脑】访问到该文件夹。增加可以备份网络映射端的访问权限（凭据）。以Windows2008为例，点击开始—控制面板—用户账户—更改Windows密码—管理网络密码—存储的用户名和密码，如下图：点击【添加】，输入服务器、工作组或是网络位置，输入访问使用的用户名和密码，输入完后点击【确定】即可在上图所示的对话框看到刚添加的访问凭据，如下图所示：更改5RClient客户端服务登录用户为指定的登录用户（一般是administrator，也可以是其他用户，实际参照你安装客户端时所用用户）重启5RClient服务至此，我们已经完成了备份网络映射盘数据前的相关操作，你可以在选择数据源界面看到刚刚映射的盘符，选择相应数据就可以进行备份了，操作与普通的文件备份一样，具体参照下面介绍的文件定时备份基本操作。4.2Linux备份前置条件检查4.2.1客户端服务检查Linux文件系统备份要求同windows相似，查看客户端服务或者进程，能正常连接到控制台，即可进行文件系统的定时备份任务，检测命令如下；[root@Redhat6-64-RAIDinit.d]#serviceclientserverstatusesfdaemon-fclientd.config(pid:8396)started.[root@Redhat6-64-RAIDinit.d]#ps-ef|grepesfroot839615Mar21?01:09:06./esfdaemon-fclientd.configroot1159910958015:29pts/100:00:00grepesf4.3介质服务器检查及配置为保证备份任务可正常执行，在创建文件系统备份任务前，请检查介质服务器是否正常。检查方法，可以在登录控制台后，在存储管理，介质服务器管理中查看介质服务器状态及可用空间；第五章定时备份最佳实践5.1文件系统定时备份最佳实践5.1.1命名规则说明1.【命名规则】:用户名、任务组、任务等对象命名规则满足：不允许为空，且名称长度必须为3~50个字符；2.【邮件命名规则】:Email地址只能由字母A~Za~z、数字0~9及特殊字符@.-_组成，类似于yourname@domain.com的形式，且最长不能超过50个字符；3.【备注信息规范】：备注信息最大不超过255字符；5.2定时备份任务建立以下均已windows客户端为例1.登录爱数备份控制台，点击备份容灾选中对应的客户端在任务管理中，点击新建按钮选择定时备份选择文件系统；2.输入任务名称，在备注处，输入自己想要的备份信息，选择想要的介质服务器作为备份的目的地，信息填写完毕后，点击[下一步]按钮；3.在选项中，填设置想要的备份类型，是否开启高级功能选项，各个选项说明如下：【重复数据删除选项】勾选该选项可以启动源端重复数据删除的功能，该选项，在建立任务后，不能通过修改任务的方式更改此属性；【备份数据保存完全副本数】可以设置用户保留完全副本的个数；设置完成后，点击【下一步】按钮，继续；点击“+”号展开数据源，文件系统定时备份任务支持自动发现数据源的功能，浏览到系统的磁盘文件后，此时点击“+”号，可以正常展开数据源，选中数据源，然后点击【下一步】继续FAQS：1.如果选中数据源目录文件过多时，会分批展开数据源，首次展开100个，之后会有“更多....|全部....”的提示，尽量选择更多....的方式展开，因为单个目录下文件数据过多，一次性全部展开会比较慢2.实例配置完成后，点击展开数2.点击+号，目录展不开，提示路径中有非法字符；查看客户端的目录中，是否包含无法打开的系统乱码文件，若是目录中存在此类文件，目录均不能展开，且数据不能备份4.在选择了需要备份的数据源之后，可以看到页面右上方有4种过滤策略，有需要的用户可以根据自身的需要选择和设置各种过滤策略1）创建规则---过滤类型，设置需要过滤的某种类型的文件，然后点击【确定】类型过滤支持的过滤方式包含：a.仅包含指定的文件类型；b.排除指定的文件类型，常用文件类型包常用文件类型包括：MicrosoftOffice文件、音乐和视频文件、图片文件、PDF文件、网页文件、压缩文件、支持自定义文件类型2）创建规则---过滤文件，设置需要过滤的文件，然后点击【确定】允许用户过滤多个文件，用','分隔多个文件；3）创建规则---过滤目录，设置需要过滤的目录，然后点击【确定】填写需要过滤的目录时，需要填写目录的绝对路径，比如“C:\windows32”4）创建规则---过滤时间，设置需要过滤的某个时间段的文件，然后点击【确定】时间过滤，仅支持指定具体时间范围注意：若过滤规则与其他规则存在冲突，则提示对应的错误提示信息。详细判定依据请参考”文件过滤冲突规则表“文件过滤冲突规则表	优先级	规则内容	高	若存在多个包含条件，则需要满足所有包含条件	高	若存在多个排除条件，则需要满足其中一条即可	高	既有包含又有排除的情况下，只在包含的条件中判定排除	低	时间过滤的结束时间必须大于开始时间	中	同一“时间过滤类型”中，不可以存在时间重叠或交叉的过滤规则5.设置计划，在此步骤，用户可以选择定时备份任务的执行策略，如执行什么类型的备份任务、一次性执行、每天执行、没几周执行、每月执行；开始时间为任务生效的时间，可以根据需要设置；高级计划选项，设置好在持续的时间区间内，可以使任务在规定的时间内重复执行；同时在此步骤，可以新建、修改、删除、暂停的功能，点击对应的按钮，即可进行此操作；针对文件系统的计划任务来说，一般采用每周一次完全，每天一次增量的策略来保证数据安全，一般触发备份时间选择在用户应用较为空闲时执行，比如凌晨或周六周日；请注意，一定不要采用一次完全备份，剩下的全是增量的计划策略，以规避风险；文件系统计划任务新建、修改、删除、暂停全部的功能如下：FAQS：1.对于总数据量较大的文件系统（大于500G）来说，设置计划任务进行备份时，尽量将计划的间隔时间设置的大一些，因为任务在备份时，再次发起任务是不进行备份的，如果间隔时间较大，可以保证任务的正常执行，也可以保证每次的备份任务都成功备份。2.在设置计划策略时，请务必不要使用一个完全后续全是增量备份的方式；一个月必须要进行至少一次的完全备份，以保护数据安全；3.在任务创建完毕后，如果觉得任务配置信息有误，可以在选中该任务，并点击“编辑”按钮，进行编辑；编辑的步骤，和创建任务的步骤基本相同；6.进行windows文件系统的备份时，若是在界面修改数据源，进行增量备份，任务将自动转化成完全备份，windows下文件的增量备份，若是备份的文件里有被修改的文件，直接将任务以增量备份启动，不要在界面上修改数据源，若是在界面上操作，系统默认为数据源改变，会自动执行完全备份1.计划7.设置完毕，如果资源足够，请立即开始一次完全备份。选中任务，点击【发起】按钮，可以看到可以发起的操作类型，点击【备份】按钮，即可开始备份操作；FAQS：1.发起备份任务是，提示“请求失败，您没有进行该操作的权限”，该问题是由于控制台没有进行相关的授权，添加对应的授权后，即可解决；添加授权在控制台界面，【运营管理】(【授权管理】中添加，输入对应的授权码，点击在线激活，即可；2.发起文件系统备份任务，可以选择执行类型“完全备份”“增量备份”，如果首次选择增量备份备份任务，任务将自动转为完全备份3.windows下文件定时备份，完备数据源后，若是在数据源中新建文件夹，直接进行增量备份，文件夹备份不上（新建的文件可以备份上），原因：windows下文件的增量备份，是归档位增量备份，先要判断该文件或者文件夹的归档位存在不存在，然后再进行备份，在windows下新建文件夹，文件夹的归档位是没有勾选的，所以增量备份不上该文件夹，而新建的文件是有归档位的，所以新建的文件可以备份上，若是想要备份该文件夹，首先加上该文件夹的归档位，如图：点击右键，文件夹【属性】中的常规下点击【高级】，勾选可以存档文件夹即可。注：备份Linux客户端下的文件，任务的建立和执行步骤请参考window环境下的流程。4.windows下文件定时备份，增量备份数据源后，发现备份成功，但是数据实际备份量为0，原因同上述3，windows下的增量备份只用归档位的增量，如果文件的归档位没有加上，增量备份时不会备份上。5.备份提示信息，提示：“无法去除文件（目录）XXXX的归档位信息”，备份任务成		功原因：我们的备份对windows下的文件进行备份时，会去除文件的归档位属性，已标志文件被备份过，但是某些软件或者软件的安装配置文件的归档位属性不允许去除（手动无法去除），在备份时会成功备份上这部分文件，但是文件的归档位不会被去除影响：归档位没有被去除的话，对此任务进行增量备份时，每次都会增量备份上此部分内容6.备份linux环境下的某些目录和文件，查看历史记录信息时，看到统计的文件（目录）数目与实际备份的文件（目录）数目不一致原因：备份过程中，自动过滤掉了linux系统中的设备文件和管道文件，不影响正常文件数据的备份恢复。第六章定时恢复最佳实践6.1文件系统恢复概述	AnyBackup5.0.1版本与AnyBackup3.5的恢复方式相同，采用浏览恢复的方式进行邮件客户端的恢复操作	【普通恢复方式】和AnyBackup3.5的方式相同，选择备份集中备份的所有数据，再选择需要恢复的路径进行恢复；	当用户的文件丢失、误删、损坏，或者客户机出现故障时，需要做异机的迁移时，可以进行文件的浏览恢复将文件信息恢复到备份时的状态。6.2普通恢复6.2.1普通恢复注意事项1、恢复目的地客户端需在线，且目的地中该文件不正在使用，可以进行覆盖操作；2、支持异机文件恢复，但恢复后的文件属性可能会发生变化。3、不支持跨平台恢复（windows与linux之间互相跨平台恢复）6.2.2恢复步骤备注：windows和Linux只有恢复端的操作系统不一致，控制台的操作步骤一样。故具体的恢复流程均可参考下述恢复步骤。1.在备份容灾的【任务管理】界面中选择备份任务，发起【浏览恢复】2.跳转到【恢复】界面，选择要恢复的时间点及数据注意：如果是要恢复到最新状态，推荐选择最新时间点。因为选择的时间点恢复成功后的数据实际上是当时备份的数据，并不是最新的。3.选择恢复位置，默认为恢复至原客户端原位置选择好路径后，确定恢复策略，恢复策略默认选择总是替换已存在的文件，也可选择其他两个恢复策略，然后点击【完成】，即可恢复FAQS：Linux备份恢复，备份linux下的某些目录或者文件，原位置恢复时，会抛出大量警告，提示文件（目录）无法恢复原因：由于当前系统运行所依赖的文件正在运行，不能被修改和替换，所以原位置恢复时会抛出警告，提示不允许恢复解决方法：若是备份了linux的整个根目录或者一些系统文件，恢复时将文件（目录）恢复到其他位置，不要进行原位置恢复。6.2.3异机恢复操作步骤普通恢复可以做异机恢复，针对异机恢复，仅是在恢复选择恢复位置的时候有所不同，恢复的客户端选择其他客户端选择完成后浏览异机的磁盘路径，也可手动填写路径信息，然后选择点击【下一步】FAQS：1.若是选择恢复数据到异位置，若是自己手动输入的路径，确保路径存在，若是路径不存在，界面会弹出错误提示框解决方法：尽量选择【浏览】的方式查看恢复路径然后执行，若是手动输入，确保本机或者异机的客户端存在此路径2.恢复时输入的路径必须符合路径命名规则，若是不符合路径规则，会提示路径不合法(WWW.EISOO.COM)(7/49)